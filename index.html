<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Мои заметки</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div id="app">
    <h1>Мои заметки</h1>
    <div class="board">
        <!-- Один цикл по колонкам, без вложенных повторений -->
        <div class="column" v-for="col in columns" :key="col.id">
            <h2>{{ col.title }} ({{ cards.filter(c => c.col === col.id).length }})</h2>

            <!-- Карточки текущей колонки -->
            <div v-for="card in cards.filter(c => c.col === col.id)" :key="card.id"
                 class="card"
                 :class="{ locked: card.col === 1 && isColumn1Locked }">
                <input v-model="card.title"
                       placeholder="Заголовок"
                       :disabled="card.col === 1 && isColumn1Locked">
                <ul>
                    <li v-for="(item, idx) in card.items" :key="idx">
                        <input type="checkbox"
                               v-model="item.completed"
                               @change="checkAndMove(card)"
                               :disabled="card.col === 1 && isColumn1Locked">
                        <input v-model="item.text"
                               placeholder="Текст пункта"
                               :disabled="card.col === 1 && isColumn1Locked">
                        <button v-if="card.items.length > 3"
                                @click="removeItem(idx, card)"
                                :disabled="card.col === 1 && isColumn1Locked">✖</button>
                    </li>
                </ul>
                <button v-if="card.items.length < 5"
                        @click="addItem(card)"
                        :disabled="card.col === 1 && isColumn1Locked">+ Добавить пункт</button>

                <!-- Дата завершения для третьей колонки -->
                <div v-if="card.col === 3 && card.completedAt" class="completed-date">
                    Завершено: {{ card.completedAt }}
                </div>
            </div>

            <!-- Кнопка добавления карточки в колонку -->
            <button @click="addCard(col.id)"
                    :disabled="
                        (col.id === 1 && (isColumn1Locked || cards.filter(c => c.col === 1).length >= 3)) ||
                        (col.id === 2 && cards.filter(c => c.col === 2).length >= 5)
                    ">
                + Добавить карточку
            </button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>